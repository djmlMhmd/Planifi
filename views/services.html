<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Liste des Services</title>
	</head>
	<body>
		<h1>Liste des Services</h1>
		<ul id="services-list"></ul>

		<script>
			// Fonction pour effectuer une requête API et afficher les services
			function getServices() {
				fetch('/service', { method: 'GET' })
					.then((response) => response.json())
					.then((services) => {
						const servicesList =
							document.getElementById('services-list');
						services.forEach((service) => {
							const listItem = document.createElement('li');
							const durationHours = service.duration.hours;
							listItem.innerHTML = `
			                         <strong>Service: </strong>${service.service_name}<br>
			                         <strong>Description: </strong>${service.service_description}<br>
			                         <strong>Prix: </strong>${service.service_price} €<br>
			                         <strong>Durée: </strong>${durationHours} heures<br>
			                         <strong>Professionnel: </strong>${service.email}<br>
			                         <strong>Téléphone: </strong>${service.phone}<br>
			                         <strong>Entreprise: </strong>${service.company_name}<br>
			                         <strong>Adresse: </strong>${service.company_address}<br><br>
			                         <button onclick="reserveService(${service.service_id})">Réserver</button><br><br>
			                     `;
							servicesList.appendChild(listItem);
						});
					})
					.catch((error) => {
						console.error(
							'Erreur lors de la récupération des services:',
							error
						);
					});
			}

			function reserveService(serviceId) {
				const reservationData = {
					service_id: 3,
					users_id: 4,
					professional_id: 4,
					start_time: '14:00:00',
					default_availability_id: 9,
					day_of_week: 'Mardi',
				};

				fetch('/reservation', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(reservationData),
				})
					.then((response) => {
						if (response.status === 201) {
							return response.json();
						} else {
							throw new Error('Erreur lors de la réservation');
						}
					})
					.then((data) => {
						alert(
							'Réservation effectuée avec succès : ' +
								data.message
						);
					})
					.catch((error) => {
						alert(
							'Erreur lors de la réservation : ' + error.message
						);
					});
			}

			// Appeler la fonction pour obtenir la liste des services lors du chargement de la page
			document.addEventListener('DOMContentLoaded', getServices);
		</script>
	</body>
</html>
