<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Planifi/login</title>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no"
		/>
		<link
			rel="stylesheet"
			href="https://unicons.iconscout.com/release/v2.1.9/css/unicons.css"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css"
		/>
		<link rel="stylesheet" href="" />
	</head>
	<body>
		<div class="section">
			<div class="container">
				<div class="row full-height justify-content-center">
					<div class="col-12 text-center align-self-center py-5">
						<div class="section pb-5 pt-5 pt-sm-2 text-center">
							<h6 class="mb-0 pb-3">
								<a href="inscription">Sign Up</a>
							</h6>
							<input
								class="checkbox"
								type="checkbox"
								id="reg-log"
								name="reg-log"
							/>
							<label for="reg-log"></label>
							<div class="card-3d-wrap mx-auto">
								<div class="card-3d-wrapper">
									<div class="card-front">
										<div class="center-wrap">
											<div class="section text-center">
												<h4 class="mb-4 pb-3">
													Log In
												</h4>
												<form id="login-form">
													<div class="form-group">
														<input
															type="email"
															class="form-style"
															name="email"
															id="email"
															placeholder="Email"
														/>
														<i
															class="input-icon uil uil-at"
														></i>
													</div>
													<div
														class="form-group mt-2"
													>
														<input
															type="password"
															class="form-style"
															name="password"
															id="password"
															placeholder="Password"
														/>
														<i
															class="input-icon uil uil-lock-alt"
														></i>
													</div>
													<button
														type="submit"
														class="btn mt-4"
													>
														Login
													</button>
												</form>
												<p
													class="mb-0 mt-4 text-center"
												>
													<a href="" class="link"
														>Forgot your
														password?</a
													>
												</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			document
				.getElementById('login-form')
				.addEventListener('submit', async (event) => {
					event.preventDefault(); // Prevent form submission by default

					const email = document.getElementById('email').value;
					const password = document.getElementById('password').value;

					const response = await fetch('/connexion', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({ email, password }),
					});

					if (response.status === 200) {
						// Authentication successful, redirect the user to the profile page
						const userData = await response.json();
						if (userData.users_id) {
							console.log('id client:', userData.users_id);
							window.location.href = `/profil/${userData.users_id}`;
						} else if (userData.professional_id) {
							window.location.href = `/profil/${userData.professional_id}`;
						}
					} else {
						// Handle failed authentication, for example by displaying an error message
						console.log("Ã‰chec de l'authentification");
					}
				});
		</script>
	</body>
</html>
