<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Inscription - Particulier/Professionnel</title>
	</head>
	<body>
		<h1>Inscription - Particulier/Professionnel</h1>
		<form id="registration-form">
			<label for="user_type">Type d'utilisateur:</label>
			<select id="user_type" name="user_type" required>
				<option value="client">Particulier</option>
				<option value="professional">Professionnel</option></select
			><br /><br />

			<label for="firstName">Prénom:</label>
			<input
				type="text"
				id="firstName"
				name="firstName"
				required
			/><br /><br />

			<label for="lastName">Nom de famille:</label>
			<input
				type="text"
				id="lastName"
				name="lastName"
				required
			/><br /><br />

			<label for="phone">Téléphone:</label>
			<input type="text" id="phone" name="phone" required /><br /><br />

			<label for="email">Adresse e-mail:</label>
			<input type="email" id="email" name="email" required /><br /><br />

			<label for="password">Mot de passe:</label>
			<input
				type="password"
				id="password"
				name="password"
				required
			/><br /><br />

			<!-- Champs spécifiques au professionnel -->
			<div class="professional-fields" style="display: none">
				<label for="company_name">Nom de l'entreprise:</label>
				<input
					type="text"
					id="company_name"
					name="company_name"
				/><br /><br />

				<label for="company_address">Adresse de l'entreprise:</label>
				<input
					type="text"
					id="company_address"
					name="company_address"
				/><br /><br />
			</div>

			<input type="submit" value="S'inscrire" />
		</form>

		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const form = document.getElementById('registration-form');
				const user_type = document.getElementById('user_type');
				const professionalFields = document.querySelector(
					'.professional-fields'
				);

				// Fonction pour gérer l'affichage conditionnel des champs professionnels
				function toggleProfessionalFields() {
					if (user_type.value === 'professional') {
						professionalFields.style.display = 'block';
					} else {
						professionalFields.style.display = 'none';
					}
				}

				// Gérer l'affichage initial
				toggleProfessionalFields();

				// Gérer l'affichage des champs en fonction du choix de l'utilisateur
				user_type.addEventListener('change', toggleProfessionalFields);

				form.addEventListener('submit', async (event) => {
					event.preventDefault();

					const formData = new FormData(form);
					const formDataObject = {};

					formData.forEach((value, key) => {
						formDataObject[key] = value;
					});

					try {
						let userType = user_type.value;
						if (userType === 'client') {
							userType = 'client';
						} else {
							userType = 'professional';
						}

						const response = await fetch(
							`/inscription?user_type=${userType}`,
							{
								method: 'POST',
								body: JSON.stringify(formDataObject),
								headers: {
									'Content-Type': 'application/json',
								},
							}
						);

						if (response.ok) {
							const result = await response.json();
							console.log('Inscription réussie:', result);
						} else {
							const errorData = await response.json();
							console.error(
								"Erreur lors de l'inscription:",
								errorData
							);
						}
					} catch (error) {
						console.error('Erreur lors de la requête API:', error);
					}
				});
			});
		</script>
	</body>
</html>
